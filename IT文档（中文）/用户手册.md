## 用户手册

### 1. 概述

本用户手册旨在帮助您快速安装、运行并使用“跨境电商物流Demo”。这是一个基于区块链的跨境物流平台原型，通过Streamlit提供交互式界面，展示需求发布、多阶段竞价、自动化支付和代币经济的完整流程。本Demo主要以伪分布式模式运行，充分体现了项目的核心创新点，适合竞赛评委、开发者或测试用户体验。

---

### 2. 系统要求

在开始之前，请确保您的设备满足以下要求：
- **操作系统**：Windows、MacOS或Linux。
- **Python版本**：3.8或以上（推荐3.9或3.10）。
- **网络**：伪分布式模式无需实时网络连接；若尝试真实分布式模式，需访问Ethereum Sepolia测试网。
- **浏览器**：支持现代网页的浏览器（如Chrome、Firefox）以访问Streamlit界面。

---

### 3. 安装步骤

#### 3.1 安装依赖
1. 确保已安装Python 3.8+，可通过以下命令检查：
   ```bash
   python --version
   ```
   或
   ```bash
   python3 --version
   ```
2. 在项目根目录下安装所需Python库：
   ```bash
   pip install -r requirements.txt
   ```
   - `requirements.txt`包含所有依赖，如`streamlit`、`matplotlib`、`web3`等。
   - 若遇到权限问题，可尝试：
     ```bash
     pip install -r requirements.txt --user
     ```
   - 若使用虚拟环境，需先激活：
     ```bash
     python -m venv venv
     source venv/bin/activate  # Linux/MacOS
     venv\Scripts\activate     # Windows
     ```

#### 3.2 运行程序
1. 在项目目录下运行以下命令启动Demo：
   ```bash
   streamlit run main.py
   ```
2. **初始化说明**：
   - 启动后，系统会自动运行`init_data.py`，初始化10个模拟需求及其相关交易（包括竞价、支付和代币补偿）。
   - 初始化涉及生成多个区块和交易（约40-50笔交易，10+区块），需要模拟多节点协作和挖矿，因此**首次加载可能需要约5分钟**。
   - 请耐心等待终端输出类似以下信息：
     ```
     初始化完成：生成 X 个区块，Y 笔交易，代币流通量 Z
     You can now view your Streamlit app in your browser.
     Local URL: http://localhost:8501
     ```
   - 初始化完成后，账本和代币系统将预填充数据，便于后续操作。
3. 打开浏览器，访问`http://localhost:8501`，进入Demo界面。

#### 3.3 运行模式说明
- **伪分布式模式（默认推荐）**：
  - 单机模拟区块链，无需复杂配置。
  - 通过伪分布式模式即可完整展示多阶段竞价、碳排放激励、自动化支付等核心创新点。
  - 适合快速体验和竞赛演示。
- **真实分布式模式（可选）**：
  - 连接Ethereum Sepolia测试网，需配置`.env`文件（包括RPC URL、私钥、合约地址等）。
  - 由于链上配置复杂且非项目核心展示重点，本Demo以伪分布式为主。

---

### 4. 使用指南

#### 4.1 主界面概览
启动后，您将看到标题为“跨境电商物流Demo”的Streamlit界面，包含：
- **侧边栏**：系统设置和状态概览。
- **主区域**：四个标签页：
  - **需求发布**：提交物流需求。
  - **竞价方案**：查看和选择运输方案。
  - **支付管理**：跟踪支付进度。
  - **系统状态**：查看账本和代币统计。

#### 4.2 侧边栏操作
1. **选择运行模式**：
   - **伪分布式模式**（默认）：单机模拟，推荐使用。
   - **测试网模式**：连接真实区块链，需额外配置，仅作扩展展示。
   - 伪分布式模式已足以体现项目创新，无需测试网即可体验完整功能。
2. **状态概览**：
   - 显示区块数、活跃节点数、代币流通量和碳补偿总量。

#### 4.3 需求发布
1. 进入“需求发布”标签页。
2. 填写表单：
   - **重量 (kg)**：如1000。
   - **体积 (m³)**：如5。
   - **始发地**：如“Shanghai”。
   - **目的地**：如“Singapore”。
   - **期望时效**：如“标准型 (5-7天)”。
   - **货物类型**：如“普通货物”。
   - **CLP信息**：JSON格式的集装箱装箱单，例如：
     ```json
     [
       {"name": "Sample Item", "quantity": 100, "weight": 10, "volume": 0.05, "category": "普通货物", "dangerous": false}
     ]
     ```
3. 点击“提交需求”：
   - 系统验证CLP并生成STU。
   - 自动模拟3个运输公司（Carrier_1、Carrier_2、Carrier_3）的竞价，生成方案并触发支付。
   - 显示成功提示和当前区块数。

#### 4.4 竞价方案
1. 进入“竞价方案”标签页。
2. 查看竞价状态：
   - 未提交需求时提示“请先提交物流需求”。
   - 已提交后显示阶段（首轮、次轮或完成）。
3. 操作竞价流程：（经版本迭代已实现自动化模拟竞价，可直接进入标签页查看方案信息）
   - **首轮竞价**：点击“模拟第一轮竞价”，进入次轮。
   - **次轮竞价**：点击“模拟第二轮竞价并生成方案”，生成经济型、绿色型、均衡型方案。
4. 选择方案：
   - 显示方案表格（价格、碳排放、时效）和对比图。
   - 选择方案（如“方案 1: economic”），点击“确认方案”创建支付订单。

#### 4.5 支付管理
1. 进入“支付管理”标签页。
2. 查看支付状态：
   - 未确认方案时提示“请先确认一个方案”。
   - 已创建订单后显示支付详情（JSON格式）。
3. 推进支付：
   - 显示物流状态图（从“warehouse”到“delivery”）。
   - 点击“触发下一阶段支付”，模拟阶段推进（如“warehouse”到“customs”）。
   - 系统更新状态、转移代币并生成新区块。

#### 4.6 系统状态
1. 进入“系统状态”标签页。
2. 查看统计：
   - **账本状态**：区块数、交易数、活跃节点数。
   - **代币系统**：发行量、流通量、碳补偿总量。
   - **节点信用分**：主要节点评分。
3. 查看可视化：
   - **代币流动**：网络图展示最近10笔交易。
   - **碳排放分析**：箱线图和直方图展示排放和补偿。

---

### 5. 示例操作流程

#### 5.1 完整体验流程
1. 运行`streamlit run main.py`，等待约5分钟初始化完成，访问`http://localhost:8501`。
2. 在“需求发布”填写：
   - 重量：1000 kg
   - 体积：5 m³
   - 始发地：Shanghai
   - 目的地：Singapore
   - 时效：标准型 (5-7天)
   - 货物类型：普通货物
   - CLP：
     ```json
     [{"name": "Test Goods", "quantity": 50, "weight": 20, "volume": 0.1, "category": "普通货物", "dangerous": false}]
     ```
3. 点击“提交需求”，等待提示。
4. 进入“竞价方案”，选择并确认方案。
5. 进入“支付管理”，多次点击“触发下一阶段支付”，观察支付推进。
6. 进入“系统状态”，查看统计和图表。

---

### 6. 常见问题解答 (FAQ)

#### Q1：启动后界面迟迟未出现？
- **A**：
  - 首次运行会初始化10个需求及其交易，需约5分钟，请耐心等待终端输出“Local URL”。
  - 确保Python版本和依赖正确安装。

#### Q2：CLP验证失败？
- **A**：
  - 确保JSON格式正确。
  - 检查总重量≤28000kg，总体积≤67.7m³。

#### Q3：支付无法推进？
- **A**：
  - 确认已选择方案并创建订单。
  - 伪分布式模式下物流状态会自动同步。

#### Q4：图表未显示？
- **A**：
  - 确认`matplotlib`和`seaborn`已安装。
  - 刷新页面或重启程序。

---

### 7. 用户启发与收获

通过完整体验本Demo，您将获得以下启发和有效信息：
- **去中介化的潜力**：通过多阶段竞价和自动化支付，了解如何去除传统货代，降低物流成本（预计18%-22%）。
- **绿色物流的激励机制**：观察碳排放补偿如何通过代币经济推动环保运输选择，单位排放可降低25%-30%。
- **区块链透明性**：伪分布式账本记录每一步操作，展示分布式技术如何提升信任和效率。
- **物流与支付联动**：体验支付与物流节点（如入仓、清关）的实时绑定，理解智能支付的未来趋势。
- **可视化洞察**：通过方案对比图和代币流动网络，直观理解价格、碳排放和时效的权衡，以及代币经济的动态。
- **创新实现的简洁性**：伪分布式模式无需复杂配置即可展示核心Idea，为区块链应用的快速原型设计提供参考。

本Demo不仅是一个技术展示，更是对跨境物流行业数字化、绿色化转型的探索，启发用户思考如何将区块链技术应用于实际场景。

---

### 8. 注意事项

- **初始化时间**：首次运行需约5分钟生成初始数据，请勿中途关闭程序。
- **演示优化**：提交需求后自动完成竞价和支付，方便快速展示。
- **日志调试**：终端输出调试信息，可用于问题排查。

---

