# 跨境电商物流Demo

欢迎体验 **跨境电商物流Demo**，这是一个基于区块链的原型项目，旨在革新东亚至东南亚的跨境电商物流生态系统。本项目通过分布式账本技术优化物流流程，替代传统货代公司，实现透明、高效且环保的物流协同平台。专为金融科技竞赛设计，Demo展示了多阶段竞价、碳排放代币激励、自动化支付以及集装箱装箱单（CLP）验证等创新功能，并通过Streamlit界面提供直观的用户交互和可视化效果。
**需要注意的是，该项目版本并未明确我们团队后续对于CCP的相关讨论，为花旗杯项目第一阶段的技术实现探索，如果要理解CCP技术框架的流程体系，请移步至我们的v2版本，谢谢！**

---

## 项目概述

### 项目功能
本Demo模拟了一个公链平台，连接跨境电商商家、仓储公司、运输公司和买家，通过分布式账本实现以下功能：
- **需求与供给匹配**：透明的多阶段竞价系统提供最优报价方案。
- **绿色运输激励**：基于碳排放的代币奖励推动环保运输。
- **支付自动化**：与物流节点（如入仓、清关、配送）实时绑定触发支付。
- **分布式记录**：所有操作记录在分布式账本上，确保透明性和一致性。
- **API支持**：集成模拟的碳足迹、物流状态、合规性、地理信息和汇率接口。
- **身份验证**：通过CLP签名和节点信用评分确保交易真实性。

### 核心技术亮点
1. **分布式账本**：
   - **伪分布式模式**：单机模拟多节点协作，带有工作量证明共识（`blockchain.py`）。
   - **真实分布式模式**：支持Ethereum Sepolia测试网（`testnet.py`）。
2. **去中心化竞价**：
   - 多阶段竞价流程（首轮盲拍+次轮优化）（`bidding.py`）。
   - 提供多式联运优化方案：经济型、绿色型、均衡型。
3. **代币经济**：
   - 超级节点通过出块获得奖励（`tokens.py`）。
   - 碳排放补偿激励低排放运输。
   - 信用评分机制追踪节点可靠性（`blockchain.py`）。
4. **智能支付**：
   - 分阶段支付（入仓30%、清关40%、运输20%、配送10%）（`payment.py`）。
   - 物流里程碑触发支付，包含合规性检查。
5. **API模拟**：
   - 模拟碳足迹、物流状态、合规性、距离和汇率接口（`api.py`）。
6. **CLP验证**：
   - 使用SHA-256哈希验证需求、竞价和支付的CLP签名（`demand.py`, `payment.py`）。
   - 支持未来ECDSA或DID扩展。
7. **可视化**：
   - 基于Streamlit的交互式界面（`main.py`）。
   - Matplotlib图表展示方案对比、代币流动和碳排放分析（`visuals.py`）。

### 创新之处
- **去中介化**：去除货代中间商，降低物流成本。
- **碳减排**：将经济激励与碳排放挂钩，单位运输碳排放下降。
- **双模式账本**：兼顾演示简便性（伪分布式）和扩展性（测试网支持）。
- **增强信任**：结合API集成和CLP验证，提升合规性和真实性。

---

## 安装与运行

### 前置条件
- Python 3.8或以上版本
- Git（用于克隆仓库）
- （可选）Ethereum Sepolia测试网账户和Infura密钥（用于真实分布式模式）

### 安装步骤

1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```
   `requirements.txt`主要包含：
   - `streamlit`：网页交互界面。
   - `matplotlib`, `pandas`：数据可视化和处理。
   - `web3`：Ethereum测试网交互。
   - `requests`：API调用支持。
   - `cryptography`：数字签名支持。
2. **运行Demo**：
   ```bash
   streamlit run main.py
   ```
   - 默认启动伪分布式模式，访问`http://localhost:8501`。
   - 若使用真实分布式模式，需配置`testnet.py`（见下方说明）。

### 真实分布式模式配置
- **Infura密钥**：在Infura注册，获取Sepolia测试网RPC URL。
- **Ethereum账户**：创建账户，获取私钥并充值少量测试ETH。
- **合约部署**：使用Remix编译并部署Solidity合约，记录地址和ABI。
- **修改`testnet.py`**：
  - 在`.env`文件中填入`SEPOLIA_RPC_URL`、`PRIVATE_KEY`、`LOGISTICS_CONTRACT_ADDRESS`和`TOKEN_CONTRACT_ADDRESS`。

---

## 文件结构与功能

以下是各文件的功能概述及其相互关系。

### 1. `main.py`
- **功能**：程序入口，运行Streamlit界面，集成所有模块。
- **输入**：用户输入（需求详情、模式选择）。
- **输出**：STU、竞价方案、支付状态、可视化图表。
- **实现**：提供需求提交、竞价、支付和系统状态的交互标签；自动模拟竞价和支付。
- **关系**：调用所有核心模块，驱动完整流程。

### 2. `blockchain.py`
- **功能**：实现伪分布式账本，模拟多节点协作。
- **输入**：交易数据（需求、竞价、支付等）。
- **输出**：新区块加入链中。
- **实现**：管理节点池（超级节点、运输公司等），执行工作量证明，追踪信用评分和余额。
- **关系**：被`demand.py`、`bidding.py`、`tokens.py`、`payment.py`用于记录交易。

### 3. `demand.py`
- **功能**：处理物流需求，标准化为STU。
- **输入**：重量、体积、始发地、目的地、货物类型、CLP列表。
- **输出**：包含STU和CLP签名的需求对象。
- **实现**：计算STU（`max(weight/1000, volume/3)`），通过SHA-256验证CLP，记录到账本。
- **关系**：调用`api.py`获取距离，记录到`blockchain.py`。

### 4. `bidding.py`
- **功能**：管理多阶段竞价，生成优化方案。
- **输入**：需求数据、运输公司报价。
- **输出**：经济型、绿色型、均衡型方案。
- **实现**：模拟首轮盲拍（24小时）和次轮优化（30分钟），按价格、排放和时效评分。
- **关系**：调用`api.py`获取碳足迹，记录到`blockchain.py`。

### 5. `tokens.py`
- **功能**：管理代币经济，包括挖矿奖励和碳补偿。
- **输入**：节点ID、碳排放量。
- **输出**：更新后的余额和交易记录。
- **实现**：用字典追踪余额，奖励超级节点（每块10代币），碳补偿按8代币/单位计算。
- **关系**：记录到`blockchain.py`，使用`bidding.py`的排放数据。

### 6. `payment.py`
- **功能**：按物流节点自动化分阶段支付。
- **输入**：方案数据、支付者ID、追踪号。
- **输出**：各阶段支付状态和金额。
- **实现**：分阶段支付（入仓30%、清关40%、运输20%、配送10%），验证物流状态和合规性。
- **关系**：调用`api.py`检查状态和合规性，记录到`blockchain.py`。

### 7. `visuals.py`
- **功能**：生成方案对比、代币流动、物流状态和碳排放分析的图表。
- **输入**：方案、代币交易、支付状态、碳数据。
- **输出**：Matplotlib图表。
- **实现**：绘制方案散点图、代币网络图、物流时间线和碳排放直方图。
- **关系**：被`main.py`调用，获取`bidding.py`和`tokens.py`数据。

### 8. `testnet.py`
- **功能**：连接Ethereum Sepolia测试网，实现真实分布式账本。
- **输入**：RPC URL、私钥、合约信息。
- **输出**：交易哈希。
- **实现**：通过`web3.py`记录需求、竞价和支付，支持异步操作。
- **关系**：在`main.py`中可选集成。

### 9. `api.py`
- **功能**：模拟物流相关的外部API。
- **输入**：根据接口不同（如始发地、追踪号）。
- **输出**：模拟数据（如距离、碳足迹）。
- **实现**：提供随机但合理的模拟值，与支付状态同步物流状态。
- **关系**：被`demand.py`、`bidding.py`、`payment.py`调用。

### 10. `init_data.py`
- **功能**：初始化Demo数据，用于测试和展示。
- **输入**：需求数量（默认10）。
- **输出**：填充的账本和代币系统。
- **实现**：模拟需求、竞价、支付和代币交易。

### 11. `requirements.txt`
- **功能**：列出项目依赖（如`streamlit==1.31.0`, `web3==6.15.1`）。

### 12. `README.md`
- **功能**：本文档，提供项目说明。

---

## 工作流程
1. **用户交互 (`main.py`)**：提交需求（如1000kg，5m³，上海到新加坡）。
2. **需求处理 (`demand.py`)**：生成STU，验证CLP，记录到账本。
3. **竞价模拟 (`bidding.py`)**：模拟运输公司报价，优化方案，记录结果。
4. **代币操作 (`tokens.py`)**：奖励超级节点，根据排放补偿运输方。
5. **支付执行 (`payment.py`)**：按物流阶段触发支付，记录交易。
6. **可视化 (`visuals.py`)**：展示方案对比和代币流动。

---

## 技术实现细节

### 伪分布式账本
- **目的**：无需真实网络即可快速模拟分布式特性。
- **实现**：使用节点池，工作量证明（要求哈希前4位为0），字典存储账本。

### 真实分布式账本
- **目的**：展示真实区块链潜力。
- **实现**：通过`web3.py`连接Sepolia测试网，部署Solidity合约。

### API模拟
- **碳足迹**：根据运输类型和天气随机生成排放量。
- **物流状态**：全局字典与支付阶段同步。
- **合规性**：基于节点信用评分简化检查。

### CLP验证
- **当前**：对CLP物品列表进行SHA-256哈希验证。
- **未来**：支持ECDSA签名或DID集成。

---

